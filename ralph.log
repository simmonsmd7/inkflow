=== ITERATION 0 ===
Date: 2026-01-10
Task: Project initialization
Changes:
- Created PROMPT.md with full project specification
- Created ralph.log for progress tracking
- Installed PostgreSQL 16 and created 'inkflow' database
- Created backend directory structure (app/models, schemas, routers, services, utils)
- Created frontend directory structure (src/components, pages, hooks, services, types)
- Created backend/.env with DATABASE_URL configured
- Created backend/.env.example as template
- Created backend/requirements.txt with all dependencies
- Created .gitignore
Status: BASELINE COMPLETE
Next: P1.1 - Initialize frontend with Vite + React + TypeScript + Tailwind

=== ITERATION 1 ===
Date: 2026-01-10
Task: P1.1 - Initialize frontend with Vite + React + TypeScript + Tailwind
Changes:
- frontend/src/App.css: DELETED (using Tailwind instead)
- frontend/src/App.tsx: Updated with InkFlow welcome screen using Tailwind
- frontend/postcss.config.js: Removed tailwindcss plugin (conflicts with @tailwindcss/vite)
- frontend/index.html: Updated title to "InkFlow - Tattoo Studio Management"
- Verified: Dark theme working, custom ink color palette active, accent colors rendering
Status: COMPLETE
Next: P1.2 - Initialize backend with FastAPI + SQLAlchemy + PostgreSQL

=== ITERATION 2 ===
Date: 2026-01-10
Task: P1.2 - Initialize backend with FastAPI + SQLAlchemy + PostgreSQL
Changes:
- backend/app/config.py: Pydantic Settings for environment configuration
- backend/app/database.py: Async SQLAlchemy engine and session management
- backend/app/main.py: FastAPI application with CORS, health endpoints, lifespan
- backend/app/models/base.py: Base model with UUID, created_at, updated_at, soft delete mixin
- backend/app/models/__init__.py: Export base models
- backend/requirements.txt: Updated asyncpg to 0.31.0 for Python 3.13 compatibility
- Verified: API docs at /api/docs, health endpoints working
Status: COMPLETE
Next: P1.3 - Set up CORS and frontend-backend communication

=== ITERATION 3 ===
Date: 2026-01-10
Task: P1.3 - Set up CORS and frontend-backend communication
Changes:
- frontend/src/services/api.ts: API client with typed request methods (get, post, put, patch, delete)
- frontend/src/types/api.ts: TypeScript types for API responses (HealthResponse, ApiHealthResponse, etc.)
- frontend/src/hooks/useApiHealth.ts: React hook for API health status with loading/error states
- frontend/src/App.tsx: Updated with API connection status indicator (green/red/yellow)
- Verified: Frontend successfully connects to backend, shows "API Connected" with version/environment info
Status: COMPLETE
Next: P1.4 - Create base UI layout (sidebar nav, header, main content area)

=== ITERATION 4 ===
Date: 2026-01-10
Task: P1.4 - Create base UI layout (sidebar nav, header, main content area)
Changes:
- frontend/src/components/layout/Sidebar.tsx: Navigation with icons, badges, collapsible state, user section
- frontend/src/components/layout/Header.tsx: Search bar, API status indicator, notifications, quick actions
- frontend/src/components/layout/Layout.tsx: Main layout wrapper with sidebar and header
- frontend/src/components/layout/index.ts: Export barrel file
- frontend/src/App.tsx: Dashboard page with stats cards, schedule, and activity feed
- Verified: Sidebar collapse/expand works, API status shows "Online", dark theme consistent
Status: COMPLETE
Next: P1.5 - Implement dark/light theme toggle

=== ITERATION 5 ===
Date: 2026-01-10
Task: P1.5 - Implement dark/light theme toggle
Changes:
- frontend/src/hooks/useTheme.ts: Theme hook with localStorage persistence, system preference detection
- frontend/src/components/layout/Header.tsx: Added theme toggle button with sun/moon icons
- frontend/src/index.css: Light mode CSS variables that invert the ink color palette, smooth transitions
- Verified: Toggle switches themes, persists after refresh, smooth transition animations
Status: COMPLETE
Next: P2.1 - User registration (stub email verification)

=== ITERATION 6 ===
Date: 2026-01-10
Task: P2.1 - User registration with email verification stub
Changes:
Backend:
- backend/app/models/user.py: User model with email, password, verification tokens, roles (owner/artist/receptionist)
- backend/app/schemas/user.py: Pydantic schemas for UserCreate, AuthResponse, MessageResponse, etc.
- backend/app/services/email.py: Email service with SendGrid integration and console stub for dev mode
- backend/app/services/auth.py: Auth service with argon2 password hashing, JWT token generation
- backend/app/routers/auth.py: Auth endpoints (register, verify-email, resend-verification, login)
- backend/app/main.py: Included auth router
- Auto-verify users in development mode when SENDGRID_API_KEY is not configured

Frontend:
- frontend/src/pages/Register.tsx: Registration form with client-side validation
- frontend/src/pages/Login.tsx: Login page stub
- frontend/src/pages/Dashboard.tsx: Extracted dashboard from App.tsx
- frontend/src/services/auth.ts: Auth service for frontend API calls
- frontend/src/App.tsx: React Router setup with auth and app routes
- frontend/src/main.tsx: Added BrowserRouter wrapper
- frontend/src/services/api.ts: Improved error handling for FastAPI validation errors

- Verified: API registration works via curl and direct browser calls
- Verified: Frontend renders registration form with dark theme styling
Status: COMPLETE
Next: P2.2 - Login/logout with JWT tokens

=== ITERATION 7 ===
Date: 2026-01-10
Task: P2.2 - Login/logout with JWT tokens
Changes:
Backend:
- backend/app/routers/auth.py: Fixed login to use JSON body (UserLogin), added /me and /logout endpoints
- backend/app/services/auth.py: Added get_current_user dependency with JWT validation, HTTPBearer security

Frontend:
- frontend/src/pages/Login.tsx: Full login form with validation, error handling, loading states
- frontend/src/hooks/useAuth.tsx: AuthProvider context for global auth state management
- frontend/src/main.tsx: Wrapped app in AuthProvider
- frontend/src/components/layout/Header.tsx: Added user display (name/role) and logout button
- frontend/src/services/auth.ts: Updated login to use JSON body, added getMe method
- frontend/src/types/api.ts: Added UserDetailResponse type

- Verified: Full login flow works (form → API → dashboard redirect)
- Verified: User info displays in header after login
- Verified: Logout clears token and redirects to login page
- Verified: /me endpoint returns authenticated user profile
Status: COMPLETE
Next: P2.3 - Password reset flow (stub email to console)

=== ITERATION 8 ===
Date: 2026-01-10
Task: P2.3 - Password reset flow with email stub
Changes:
Backend:
- backend/app/routers/auth.py: Added forgot-password and reset-password endpoints
- backend/app/services/auth.py: Added reset_user_password function

Frontend:
- frontend/src/pages/ForgotPassword.tsx: Request password reset form with success state
- frontend/src/pages/ResetPassword.tsx: Reset password form with token validation and error handling
- frontend/src/pages/index.ts: Export new pages
- frontend/src/services/auth.ts: Added forgotPassword and resetPassword methods
- frontend/src/App.tsx: Added routes for /forgot-password and /reset-password

- Verified: Forgot password form submits and shows success message
- Verified: Reset password page displays correctly with token
- Verified: Error state shows when token is missing
- Verified: API endpoints work correctly (tested via curl)
Status: COMPLETE
Next: P2.4 - User roles: Owner, Artist, Receptionist

=== ITERATION 9 ===
Date: 2026-01-10
Task: P2.4 - User roles: Owner, Artist, Receptionist
Changes:
Backend:
- backend/app/services/auth.py: Added role-based access control (require_role, require_owner, etc.)
- backend/app/services/auth.py: Added list_users helper function with pagination
- backend/app/routers/users.py: NEW - Users CRUD endpoints for team management (owner only)
- backend/app/schemas/user.py: Added UserUpdate, UserInvite, UsersListResponse schemas
- backend/app/services/email.py: Added send_invite_email method
- backend/app/routers/__init__.py: Export users_router
- backend/app/main.py: Include users_router

Frontend:
- frontend/src/pages/Team.tsx: NEW - Team management page with invite/edit modals
- frontend/src/services/users.ts: NEW - API service for user management
- frontend/src/types/api.ts: Added UserUpdate, UserInvite, UsersListResponse types
- frontend/src/components/layout/Sidebar.tsx: Role-based navigation, actual routing with Link
- frontend/src/pages/index.ts: Export Team page
- frontend/src/App.tsx: Added /team route

- Verified: Users endpoint returns paginated user list (owner only)
- Verified: Invite endpoint creates new user and sends email stub
- Verified: RBAC working - artists get 403 Forbidden on /users endpoints
- Verified: Frontend build passes with no TypeScript errors
Status: COMPLETE
Next: P2.5 - Studio profile setup (name, logo, address, hours)

=== ITERATION 10 ===
Date: 2026-01-10
Task: P2.5 - Studio profile setup (name, logo, address, hours)
Changes:
Backend:
- backend/app/models/studio.py: NEW - Studio model with name, slug, description, logo_url, contact info, address, business hours (JSON), timezone, owner relationship
- backend/app/schemas/studio.py: NEW - BusinessHours/BusinessHoursDay schemas, StudioCreate, StudioUpdate, StudioResponse, StudioListResponse
- backend/app/routers/studios.py: NEW - CRUD endpoints for studios (owner only for writes), logo upload/delete with file validation (5MB, JPG/PNG/GIF/WebP)
- backend/app/models/user.py: Added owned_studios relationship
- backend/app/models/__init__.py: Export Studio model
- backend/app/schemas/__init__.py: Export studio schemas
- backend/app/routers/__init__.py: Export studios_router
- backend/app/main.py: Include studios_router, add static file serving for /uploads

Frontend:
- frontend/src/pages/StudioSettings.tsx: NEW - Full studio settings form with:
  - Logo upload with preview and delete
  - Basic info (name, description)
  - Contact info (email, phone, website)
  - Address form (line1, line2, city, state, postal, country)
  - Business hours editor with per-day open/close times and closed toggle
  - Timezone selector
  - RBAC enforcement (owner only)
- frontend/src/services/studios.ts: NEW - API service for studio CRUD and logo upload
- frontend/src/types/api.ts: Added Studio, BusinessHours, StudioCreate, StudioUpdate types
- frontend/src/pages/index.ts: Export StudioSettings
- frontend/src/App.tsx: Added /settings route

- Verified: Frontend build passes with no TypeScript errors
- Verified: API endpoints work correctly (tested via curl)
- Verified: Studio Settings page renders with proper RBAC (Access Denied for non-owners)
- Verified: Settings link visible in sidebar navigation
Status: COMPLETE
Next: P2.6 - Artist profiles (bio, portfolio gallery, specialties)

=== ITERATION 11 ===
Date: 2026-01-10
Task: P2.6 - Artist profiles (bio, portfolio gallery, specialties)
Changes:
Backend:
- backend/app/models/artist.py: NEW - ArtistProfile model (bio, specialties, years_experience, hourly_rate, minimum_booking_hours, instagram_handle, website_url) + PortfolioImage model (image_url, thumbnail_url, title, description, style, placement, display_order)
- backend/app/models/user.py: Added artist_profile relationship (one-to-one)
- backend/app/models/__init__.py: Export new models
- backend/app/schemas/artist.py: NEW - Pydantic schemas for ArtistProfile, PortfolioImage, ArtistSummary, ArtistDetailResponse, ArtistsListResponse, ReorderPortfolioRequest
- backend/app/schemas/__init__.py: Export new schemas
- backend/app/routers/artists.py: NEW - Artists router with endpoints:
  - GET /artists - List all artists with pagination and specialty filter
  - GET /artists/me/profile - Get current artist's profile
  - PUT /artists/me/profile - Update current artist's profile (creates if doesn't exist)
  - GET /artists/{id} - Get specific artist's public profile
  - POST /artists/me/portfolio - Upload portfolio image (10MB max, JPEG/PNG/GIF/WebP)
  - PUT /artists/me/portfolio/{id} - Update portfolio image metadata
  - DELETE /artists/me/portfolio/{id} - Delete portfolio image
  - PUT /artists/me/portfolio/reorder - Reorder portfolio images
- backend/app/routers/__init__.py: Export artists_router
- backend/app/main.py: Include artists router, create uploads/portfolio directory

Frontend:
- frontend/src/types/api.ts: Added PortfolioImage, ArtistSummary, ArtistDetail, ArtistProfileUpdate, PortfolioImageUpdate, ArtistsListResponse types
- frontend/src/services/artists.ts: NEW - API service for artist profile and portfolio management
- frontend/src/pages/ArtistProfile.tsx: NEW - Profile editing page with:
  - Bio textarea for describing style and approach
  - Years of experience, hourly rate, min booking hours inputs
  - Specialties management with dropdown and tags
  - Instagram handle and website URL inputs
  - Portfolio gallery with upload, edit, delete, and reorder functionality
  - RBAC check (only artists and owners can access)
- frontend/src/pages/index.ts: Export ArtistProfile
- frontend/src/App.tsx: Added /profile route
- frontend/src/components/layout/Sidebar.tsx: Added "My Profile" nav item for artists and owners

- Verified: Frontend build passes with no TypeScript errors
- Verified: Profile save works correctly (tested in browser)
- Verified: Backend logs show successful PUT /api/v1/artists/me/profile returning 200 OK
- Verified: Profile page accessible at /profile with proper RBAC enforcement
Status: COMPLETE
Next: P3.1 - Availability calendar for artists

=== ITERATION 12 ===
Date: 2026-01-10
Task: P3.1 - Availability calendar for artists
Changes:
Backend:
- backend/app/models/availability.py: NEW - ArtistAvailability model (user_id, day_of_week, start_time, end_time, is_available) + ArtistTimeOff model (user_id, start_date, end_date, reason, notes, all_day)
- backend/app/models/user.py: Added availability_slots and time_off_periods relationships
- backend/app/models/__init__.py: Export new models
- backend/app/schemas/availability.py: NEW - Pydantic schemas for AvailabilitySlot, TimeOff, WeeklySchedule, BulkAvailabilityUpdate, and API response types with validation
- backend/app/schemas/__init__.py: Export new schemas
- backend/app/routers/availability.py: NEW - Availability router with endpoints:
  - GET /availability/me - Get current artist's weekly schedule
  - PUT /availability/me - Bulk update weekly schedule
  - POST /availability/me/slot - Add single availability slot
  - PUT /availability/me/slot/{id} - Update single slot
  - DELETE /availability/me/slot/{id} - Delete single slot
  - GET /availability/{artist_id} - Get artist's public availability
  - GET/POST/PUT/DELETE /availability/me/time-off - Manage time-off periods
  - GET /availability/{artist_id}/time-off - Get artist's public time-off
- backend/app/routers/__init__.py: Export availability_router
- backend/app/main.py: Include availability router

Frontend:
- frontend/src/types/api.ts: Added AvailabilitySlot, TimeOff, WeeklySchedule, and related types
- frontend/src/services/availability.ts: NEW - API service for availability and time-off management
- frontend/src/pages/Availability.tsx: NEW - Availability page with:
  - Weekly schedule editor with toggle switches for each day
  - Time selectors (10:00-18:00 default) for open/close times
  - Time-off section with add/delete functionality
  - Modal for adding new time-off periods with date pickers
  - RBAC check (only artists and owners can access)
- frontend/src/pages/index.ts: Export Availability
- frontend/src/App.tsx: Added /availability route
- frontend/src/components/layout/Sidebar.tsx: Added "Availability" nav item for artists and owners

- Verified: Frontend build passes with no TypeScript errors
- Verified: Availability page renders correctly with weekly schedule and time-off sections
- Verified: Toggle switches work to enable/disable days
- Verified: Time selectors appear when day is enabled
Status: COMPLETE
Next: P3.2 - Booking request form

=== ITERATION 13 ===
Date: 2026-01-10
Task: P3.2 - Booking request form
Changes:
Backend:
- backend/app/models/booking.py: NEW - BookingRequest model (client_name, client_email, client_phone, design_idea, placement, size, is_cover_up, is_first_tattoo, color_preference, budget_range, additional_notes, preferred_artist_id, assigned_artist_id, status, quoted_price, deposit_amount, estimated_hours, quote_notes, quoted_at, preferred_dates, scheduled_date, scheduled_duration_hours, internal_notes) + BookingReferenceImage model (booking_request_id, image_url, thumbnail_url, original_filename, display_order, notes)
- backend/app/models/booking.py: TattooSize enum (tiny, small, medium, large, extra_large, half_sleeve, full_sleeve, back_piece, full_body) + BookingRequestStatus enum (pending, reviewing, quoted, deposit_requested, deposit_paid, confirmed, completed, rejected, cancelled)
- backend/app/models/user.py: Added preferred_booking_requests and assigned_booking_requests relationships
- backend/app/models/studio.py: Added booking_requests relationship
- backend/app/models/__init__.py: Export new models
- backend/app/schemas/booking.py: NEW - Pydantic schemas for BookingRequestCreate, BookingRequestUpdate, BookingRequestResponse, BookingRequestSummary, BookingRequestsListResponse, BookingSubmissionResponse, ArtistOptionResponse, ReferenceImageResponse
- backend/app/schemas/__init__.py: Export new schemas
- backend/app/routers/bookings.py: NEW - Bookings router with endpoints:
  - GET /bookings/studios/{slug}/artists - Get artists for studio (public)
  - POST /bookings/studios/{slug}/submit - Submit booking request (public)
  - POST /bookings/requests/{id}/images - Upload reference image
  - GET /bookings/requests - List booking requests (authenticated)
  - GET /bookings/requests/{id} - Get single request (authenticated)
  - PATCH /bookings/requests/{id} - Update request (authenticated)
  - DELETE /bookings/requests/{id} - Delete request (authenticated)
- backend/app/routers/__init__.py: Export bookings_router
- backend/app/main.py: Include bookings router, create uploads/references directory

Frontend:
- frontend/src/types/api.ts: Added TattooSize, BookingRequestStatus, ReferenceImage, BookingRequestCreate, BookingSubmissionResponse, ArtistOption, BookingRequestSummary, BookingRequest, BookingRequestsListResponse types
- frontend/src/services/bookings.ts: NEW - API service for booking submission (getStudioArtists, submitBookingRequest, uploadReferenceImage)
- frontend/src/pages/BookingForm.tsx: NEW - Public booking form with:
  - Contact information (name, email, phone)
  - Tattoo details (design idea, placement, size selector, color preference, budget range, cover-up/first tattoo checkboxes)
  - Reference images upload (up to 5 images)
  - Preferences (artist dropdown, preferred dates, additional notes)
  - Client-side validation with error display
  - Loading state during submission
  - Success confirmation with reference ID display
- frontend/src/pages/index.ts: Export BookingForm
- frontend/src/App.tsx: Added /book/:studioSlug route (public)

- Verified: Frontend build passes with no TypeScript errors
- Verified: Booking form renders correctly at /book/test-studio
- Verified: Artist dropdown loads from API
- Verified: Form validation works (shows errors for missing required fields)
- Verified: Booking submission creates record in database with 201 Created response
- Verified: Success screen displays with reference ID after submission
Status: COMPLETE
Next: P3.3 - Request queue dashboard for artists to review

=== ITERATION 14 ===
Date: 2026-01-10
Task: P3.3 - Request queue dashboard for artists to review
Changes:
Backend:
- No changes needed - all required endpoints already exist in backend/app/routers/bookings.py:
  - GET /bookings/requests - List requests with pagination and status filtering
  - GET /bookings/requests/{id} - Get single request details
  - PATCH /bookings/requests/{id} - Update request (status, quotes)
  - DELETE /bookings/requests/{id} - Delete request (owner only)

Frontend:
- frontend/src/types/api.ts: Added BookingRequestUpdate interface for updating booking requests (status, quoted_price, deposit_amount, estimated_hours, quote_notes, internal_notes, etc.)
- frontend/src/services/bookings.ts: Extended with authenticated endpoints:
  - listBookingRequests() - List requests with pagination and status filter
  - getBookingRequest() - Get single request details
  - updateBookingRequest() - Update request status/quote
  - deleteBookingRequest() - Delete request
- frontend/src/pages/BookingQueue.tsx: NEW - Booking queue page with:
  - Status filter tabs (All, Pending, Reviewing, Quoted, Confirmed, Completed)
  - Request cards showing client name, status badge, design idea, placement, size, reference image count, quoted price
  - Detail modal with:
    - Full client contact info
    - Status change buttons (all 9 states)
    - Complete design details (idea, placement, size, cover-up, first tattoo, color preference, budget, preferred dates, additional notes)
    - Reference images gallery with links
    - Quote form (price, hours, deposit, notes visible to client, private internal notes)
    - Quote history section
    - Timestamps (created, updated)
  - Pagination for large request lists
  - RBAC enforcement (artists and owners only)
  - Fixed React Rules of Hooks violation (moved useEffect before conditional return)
- frontend/src/pages/index.ts: Export BookingQueue
- frontend/src/App.tsx: Added /bookings route
- frontend/src/components/layout/Sidebar.tsx: Added role restriction for Bookings nav item (artists/owners only)

- Verified: Frontend build passes with no TypeScript errors
- Verified: BookingQueue page loads correctly at /bookings
- Verified: Request cards display with proper status badges
- Verified: Detail modal opens with full request information
- Verified: Quote form displays with editable fields
- Verified: Status buttons render for changing request state
Status: COMPLETE
Next: P3.4 - Quote and deposit system

=== ITERATION 15 ===
Date: 2026-01-10
Task: P3.4 - Quote and deposit request workflow
Changes:
Backend:
- backend/app/models/booking.py: Added deposit tracking fields (deposit_payment_token, deposit_requested_at, deposit_request_expires_at, deposit_paid_at, deposit_stripe_payment_intent_id)
- backend/app/schemas/booking.py: Added SendDepositRequestInput, SendDepositRequestResponse, DepositPaymentInfo schemas with deposit tracking fields
- backend/app/services/email.py: Added send_deposit_request_email() with professional HTML email template including payment link
- backend/app/routers/bookings.py: Added endpoints:
  - POST /bookings/requests/{id}/send-deposit-request - Send deposit request to client (authenticated)
  - GET /bookings/deposit/{token} - Get deposit payment info by token (public)
  - Fixed timezone-aware datetime comparison for is_expired check

Frontend:
- frontend/src/types/api.ts: Added deposit tracking fields to BookingRequest, plus SendDepositRequestInput, SendDepositRequestResponse, DepositPaymentInfo types
- frontend/src/services/bookings.ts: Added sendDepositRequest(), getDepositInfo() functions
- frontend/src/pages/BookingQueue.tsx: Added:
  - "Send Deposit Request" button (shows when quote exists and status is reviewing/quoted)
  - Deposit request modal with amount input, expiration days, custom message
  - Success state showing payment link
  - Deposit status display section showing when deposit was requested

Database Migration:
- Added columns: deposit_payment_token, deposit_requested_at, deposit_request_expires_at, deposit_paid_at, deposit_stripe_payment_intent_id
- Added index on deposit_payment_token for token lookup

- Verified: Send deposit request endpoint works correctly
- Verified: Email stub logs professional email with payment link to console
- Verified: Public deposit info endpoint returns correct data for payment page
- Verified: Frontend build passes with no TypeScript errors
Status: COMPLETE
Next: P3.5 - Stripe integration for deposit collection

=== ITERATION 16 ===
Date: 2026-01-10
Task: P3.5 - Stripe integration for deposit collection
Changes:
Backend:
- backend/app/services/stripe_service.py: NEW - Stripe service with:
  - Checkout session creation (real Stripe or stub mode)
  - Webhook event construction and validation
  - Payment success handling
  - Stub mode that logs to console when STRIPE_SECRET_KEY not configured
- backend/app/routers/bookings.py: Added endpoints:
  - POST /bookings/deposit/{token}/create-checkout - Create Stripe checkout session
  - POST /bookings/deposit/{token}/confirm-stub - Confirm stub payment (dev mode)
- backend/app/schemas/booking.py: Added CheckoutSessionResponse, StubPaymentConfirmation schemas

Frontend:
- frontend/src/pages/DepositPayment.tsx: NEW - Deposit payment page showing:
  - Client name, studio name, artist name
  - Design summary and artist notes
  - Quoted price and deposit amount due
  - Expiry date with is_expired handling
  - Pay button that creates checkout session
  - Error state for invalid/expired tokens
- frontend/src/pages/StubCheckout.tsx: NEW - Simulated checkout for dev mode:
  - Fake card form with test values
  - Development mode warning banner
  - Confirm Payment button that calls confirm-stub endpoint
- frontend/src/pages/PaymentSuccess.tsx: NEW - Success page with:
  - Green checkmark and "Payment Successful!" message
  - "What happens next?" list
  - Reference ID display
- frontend/src/services/bookings.ts: Added createCheckoutSession(), confirmStubPayment() functions
- frontend/src/pages/index.ts: Export new pages
- frontend/src/App.tsx: Added routes:
  - /pay-deposit/:token - Deposit payment page
  - /pay-deposit/:token/stub-checkout - Stub checkout page
  - /pay-deposit/:token/success - Payment success page

- Verified: Frontend build passes with no TypeScript errors
- Verified: StubCheckout page renders correctly with simulated card form
- Verified: DepositPayment page shows proper error for invalid tokens
- Verified: PaymentSuccess page renders with confirmation and next steps
- Verified: All endpoints registered in OpenAPI spec
Status: COMPLETE
Next: P3.6 - Booking confirmation with calendar invite

=== ITERATION 17 ===
Date: 2026-01-10
Task: P3.6 - Booking confirmation with calendar invite
Changes:
Backend:
- backend/app/services/calendar.py: NEW - iCalendar service with:
  - RFC 5545 compliant .ics file generation
  - generate_ics() method for generic calendar events
  - generate_tattoo_appointment_ics() method for tattoo-specific events
  - VALARM reminders (1 day and 2 hours before appointment)
  - Proper timezone handling with UTC conversion
- backend/app/services/email.py: Extended with:
  - EmailAttachment dataclass for file attachments
  - Updated EmailMessage to include attachments list
  - Updated _send_stub() to display attachment info
  - Updated _send_sendgrid() to include base64-encoded attachments
  - send_booking_confirmation_email() with HTML template and calendar invite
- backend/app/schemas/booking.py: Added ConfirmBookingInput, BookingConfirmationResponse schemas
- backend/app/routers/bookings.py: Added endpoint:
  - POST /bookings/requests/{id}/confirm - Confirm booking with scheduled date/time
  - Only allows confirmation when status is deposit_paid
  - Updates status to confirmed, sets scheduled_date and duration
  - Generates calendar invite and sends confirmation email

Frontend:
- frontend/src/types/api.ts: Added ConfirmBookingInput, BookingConfirmationResponse types
- frontend/src/services/bookings.ts: Added confirmBooking() function
- frontend/src/pages/BookingQueue.tsx: Added:
  - "Confirm Appointment" button (shows when status is deposit_paid)
  - Confirm booking modal with date picker, time picker, duration input
  - Send confirmation email checkbox (default true)
  - Success handling that closes modal and refreshes list

- Verified: Frontend build passes with no TypeScript errors
- Verified: Backend health check passes
- Verified: Confirm endpoint registered at /api/v1/bookings/requests/{id}/confirm
- Verified: Both frontend (5173) and backend (8000) servers running
Status: COMPLETE
Next: P3.7 - Basic appointment calendar view

=== ITERATION 18 ===
Date: 2026-01-10
Task: P3.7 - Automated reminders (24hr, 2hr before appointment)
Changes:
Backend:
- backend/app/models/booking.py: Added reminder tracking fields (reminder_24h_sent_at, reminder_2h_sent_at)
- backend/app/services/sms.py: NEW - SMS service with Twilio integration and console stub
- backend/app/services/email.py: Added send_appointment_reminder_email() with urgency-based styling
- backend/app/routers/reminders.py: NEW - Reminders router with endpoints:
  - POST /reminders/process - Process and send pending reminders (for cron)
  - GET /reminders/pending - Get list of upcoming reminders
  - POST /reminders/test/{booking_id} - Send test reminder
- backend/app/routers/__init__.py: Export reminders_router
- backend/app/main.py: Include reminders router

Database:
- Added reminder_24h_sent_at and reminder_2h_sent_at columns to booking_requests table

- Verified: All reminder endpoints registered and accessible
- Verified: /reminders/pending returns correct response structure
- Verified: /reminders/process executes without errors
- Verified: Frontend build passes with no TypeScript errors
Status: COMPLETE
Next: P3.8 - Reschedule and cancellation handling

---
PROJECT: InkFlow - Tattoo Studio Management Platform
TARGET: Solo artists and 2-5 artist studios at $29-69/month
TECH: React/Vite/TypeScript frontend + Python/FastAPI backend
DATABASE: postgresql://marksimmons@localhost:5432/inkflow
---
